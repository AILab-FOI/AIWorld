<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="position-card" assetpath="../../elements/"><template><style>:host{display:block;margin:8px;}div#position{height:50px;padding:16px;border:1px solid black;}img{height:50px;width:50px;}</style><div id="position"><img src="images/markets/{{position.pair}}.png"> {{_formatDate(position.time)}} {{position.type}} {{position.pair}} {{position.price}}</div></template><script>var PositionCard=function(_Polymer$Element){babelHelpers.inherits(PositionCard,_Polymer$Element);babelHelpers.createClass(PositionCard,null,[{key:"is",get:function get(){return"position-card"}},{key:"properties",get:function get(){return{position:{type:Object,value:{}}}}}]);function PositionCard(){babelHelpers.classCallCheck(this,PositionCard);return babelHelpers.possibleConstructorReturn(this,(PositionCard.__proto__||Object.getPrototypeOf(PositionCard)).call(this))}babelHelpers.createClass(PositionCard,[{key:"ready",value:function ready(){babelHelpers.get(PositionCard.prototype.__proto__||Object.getPrototypeOf(PositionCard.prototype),"ready",this).call(this);Polymer.RenderStatus.afterNextRender(this,function(){})}},{key:"_formatDate",value:function _formatDate(data){return moment(data).format("DD/MM/YY H:mm")}}]);return PositionCard}(Polymer.Element);window.customElements.define(PositionCard.is,PositionCard);</script></dom-module></div><dom-module id="players-view"><template><style include="shared-styles">:host{display:block;width:100%;@apply (--layout-vertica);@apply (--layout-center-center);}#topbar{@apply (--layout-horizontal);@apply (--layout-justified);margin-top:8px;margin-bottom:8px;padding:8px;}.box{@apply (--layout-horizontal);@apply (--layout-justified);}.box .left{@apply (--layout-vertical);width:100%;}.box .right{@apply (--layout-vertical);padding:16px;width:40%;}span.title{font-size:18px;font-weight:800;padding:18px;}.notes{padding:8px;}</style><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/players/view/:id" data="{{routeData}}" tail="{{subroute}}"></app-route><iron-ajax id="ajaxGetCustomerDetails" on-response="_loadPlayerData"></iron-ajax><iron-ajax id="ajaxEditCustomer" on-response="_customerEdited"></iron-ajax><iron-ajax id="ajaxDeleteCustomer" on-response="_customerDeleted"></iron-ajax><div id="topbar"><div><span>{{_playerData.username}}</span><paper-icon-button on-tap="_editCustomer" icon="crm:edit"></paper-icon-button></div><div><vaadin-button on-tap="_deleteCustomer">Delete</vaadin-button></div></div><div class="box"><div class="left"><paper-tabs selected="{{selectedTab}}"><paper-tab>Inventory</paper-tab><paper-tab>Skills</paper-tab><paper-tab>Switches</paper-tab><paper-tab>Variables</paper-tab></paper-tabs><iron-pages selected="[[selectedTab]]"><section><vaadin-grid style="width: 100%;" name="ordersbook" aria-label="Orders book" items="[[_playerData.itemsData]]"><vaadin-grid-column resizable=""><template class="header"><span>Item ID</span></template><template>{{item.id}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Item name</span></template><template>{{item.name}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Amount</span></template><template>{{item.amount}}</template></vaadin-grid-column></vaadin-grid></section><section><vaadin-grid style="width: 100%;" name="ordersbook" aria-label="Orders book" items="[[_playerData.skillsData]]"><vaadin-grid-column resizable=""><template class="header"><span>Skill ID</span></template><template>{{item.id}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Skill name</span></template><template>{{item.name}}</template></vaadin-grid-column></vaadin-grid></section><section><vaadin-grid style="width: 100%;" name="ordersbook" aria-label="Orders book" items="[[_playerData.switchesData]]"><vaadin-grid-column resizable=""><template class="header"><span>ID</span></template><template>{{item.id}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Name</span></template><template>{{item.name}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Switch value</span></template><template>{{item.value}}</template></vaadin-grid-column></vaadin-grid></section><section><vaadin-grid style="width: 100%;" name="ordersbook" aria-label="Orders book" items="[[_playerData.variablesData]]"><vaadin-grid-column resizable=""><template class="header"><span>ID</span></template><template>{{item.id}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Name</span></template><template>{{item.name}}</template></vaadin-grid-column><vaadin-grid-column resizable=""><template class="header"><span>Switch value</span></template><template>{{item.value}}</template></vaadin-grid-column></vaadin-grid></section></iron-pages></div><div class="right"><span class="title">User info</span> <span><strong>Permissions :</strong> {{_playerData.permission}}</span> <span><strong>Last map :</strong> {{_playerData.mapId}}</span> <span><strong>Level :</strong> {{_playerData.stats.level}}</span> <span><strong>Experience :</strong> {{_playerData.realExp}}</span> <span><strong>Gold:</strong> {{_playerData.stats.gold}}</span></div></div><paper-dialog id="depositConfirmation"><h2>Please confirm</h2><span>{{depositMessage}}</span><div class="buttons" style="padding: 0px !important;"><vaadin-button dialog-dismiss="" autofocus="">Cancel</vaadin-button><vaadin-button dialog-confirm="" autofocus="" on-tap="_addDeposit">Confirm</vaadin-button></div></paper-dialog><paper-dialog id="editCustomer"><h2>Edit player</h2><iron-form id="formEditCustomer"><form><vaadin-text-field required="" value="{{customer.username}}" label="Username" name="username"></vaadin-text-field><vaadin-text-field required="" value="{{customer.permission}}" label="Permission" name="permission"></vaadin-text-field><h3>Player stats :</h3><vaadin-text-field required="" value="{{customer.stats.level}}" label="Level" name="level"></vaadin-text-field><vaadin-text-field required="" value="{{customer.stats.gold}}" label="Gold" name="gold"></vaadin-text-field><h3>Player position :</h3><vaadin-text-field required="" value="{{customer.mapId}}" label="MapID" name="mapId"></vaadin-text-field><vaadin-text-field required="" value="{{customer.x}}" label="Current X" name="x"></vaadin-text-field><vaadin-text-field required="" value="{{customer.y}}" label="Current Y" name="y"></vaadin-text-field></form></iron-form><div class="buttons" style="padding: 0px !important;"><vaadin-button dialog-dismiss="" autofocus="">Cancel</vaadin-button><vaadin-button dialog-confirm="" autofocus="" on-tap="_editCustomer">Ok</vaadin-button></div></paper-dialog></template><script>var playersView=function(_Polymer$Element){babelHelpers.inherits(playersView,_Polymer$Element);function playersView(){babelHelpers.classCallCheck(this,playersView);return babelHelpers.possibleConstructorReturn(this,(playersView.__proto__||Object.getPrototypeOf(playersView)).apply(this,arguments))}babelHelpers.createClass(playersView,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(playersView.prototype.__proto__||Object.getPrototypeOf(playersView.prototype),"connectedCallback",this).call(this);console.dir(this.serverData.gameData);this._gameLoaded=0<Object.keys(this.serverData.gameData).length?!0:!1}},{key:"_idChanged",value:function _idChanged(newId){if(this._actualId===newId||null===newId)return;this._actualId=newId;this._getCustomerDetails(this._actualId)}},{key:"_getCustomerDetails",value:function _getCustomerDetails(id){if(id===void 0)id=this.customer.id;var ironAjax=Polymer.dom(this.root).querySelector("#ajaxGetCustomerDetails");ironAjax.method="GET";ironAjax.headers={"X-Access-Token":this.authSession.token,"X-Socket-ID":window.socket.id};ironAjax.url=window.projectUrl+"/api/admin/players/"+id;ironAjax.generateRequest()}},{key:"_loadPlayerData",value:function _loadPlayerData(event){var _response=event.detail.response,_playerData=_response;this.set("customer",_response);try{_playerData.realExp=_playerData.stats.exp[1];if(this._gameLoaded){_playerData.mapId=this.serverData.gameData.MapInfos[_playerData.mapId]?this.serverData.gameData.MapInfos[_playerData.mapId].name:"N/A";if(_playerData.stats){_playerData.itemsData=[];_playerData.skillsData=[];for(var i=0,payload;i<Object.keys(_playerData.stats.items).length;i++){payload={id:Object.keys(_playerData.stats.items)[i],amount:_playerData.stats.items[Object.keys(_playerData.stats.items)[i]]};if(this.serverData.gameData.Items[payload.id])payload.name=this.serverData.gameData.Items[payload.id].name;_playerData.itemsData.push(payload)}for(var i=0,_payload;i<_playerData.stats.skills.length;i++){_payload={id:_playerData.stats.skills[i]};if(this.serverData.gameData.Skills[_payload.id])_payload.name=this.serverData.gameData.Skills[_payload.id].name;_playerData.skillsData.push(_payload)}}_playerData.switchesData=[];if(_playerData.switches){for(var i=0;i<_playerData.switches.length;i++){if(null===_playerData.switches[i])continue;var _payload2={id:i,value:_playerData.switches[i]};if(this.serverData.gameData.System.switches[_payload2.id])_payload2.name=this.serverData.gameData.System.switches[_payload2.id];_playerData.switchesData.push(_payload2)}}_playerData.variablesData=[];if(_playerData.variables){for(var i=0;i<_playerData.variables.length;i++){if(null===_playerData.variables[i])continue;var _payload3={id:i,value:_playerData.variables[i]};if(this.serverData.gameData.System.variables[_payload3.id])_payload3.name=this.serverData.gameData.System.variables[_payload3.id];_playerData.variablesData.push(_payload3)}}}this.set("_playerData",_response);_playerData.realExp=_playerData.stats.exp[1];if(this._gameLoaded){_playerData.mapId=this.serverData.gameData.MapInfos[_playerData.mapId]?this.serverData.gameData.MapInfos[_playerData.mapId].name:"N/A";if(_playerData.stats){_playerData.itemsData=[];_playerData.skillsData=[];for(var i=0,_payload4;i<Object.keys(_playerData.stats.items).length;i++){_payload4={id:Object.keys(_playerData.stats.items)[i],amount:_playerData.stats.items[Object.keys(_playerData.stats.items)[i]]};if(this.serverData.gameData.Items[_payload4.id])_payload4.name=this.serverData.gameData.Items[_payload4.id].name;_playerData.itemsData.push(_payload4)}for(var i=0,_payload5;i<_playerData.stats.skills.length;i++){_payload5={id:_playerData.stats.skills[i]};if(this.serverData.gameData.Skills[_payload5.id])_payload5.name=this.serverData.gameData.Skills[_payload5.id].name;_playerData.skillsData.push(_payload5)}}_playerData.switchesData=[];if(_playerData.switches){for(var i=0;i<_playerData.switches.length;i++){if(null===_playerData.switches[i])continue;var _payload6={id:i,value:_playerData.switches[i]};if(this.serverData.gameData.System.switches[_payload6.id])_payload6.name=this.serverData.gameData.System.switches[_payload6.id];_playerData.switchesData.push(_payload6)}}_playerData.variablesData=[];if(_playerData.variables){for(var i=0;i<_playerData.variables.length;i++){if(null===_playerData.variables[i])continue;var _payload7={id:i,value:_playerData.variables[i]};if(this.serverData.gameData.System.variables[_payload7.id])_payload7.name=this.serverData.gameData.System.variables[_payload7.id];_playerData.variablesData.push(_payload7)}}}this.set("_playerData",_response)}catch(e){console.log("Error during loading of the player.")}}},{key:"_reloadCustomer",value:function _reloadCustomer(){this._getCustomerDetails(this.customer.id)}},{key:"_deleteCustomer",value:function _deleteCustomer(){var ironAjax=Polymer.dom(this.root).querySelector("#ajaxDeleteCustomer");ironAjax.method="DELETE";ironAjax.headers={"X-Access-Token":this.authSession.token,"X-Socket-ID":window.socket.id};ironAjax.url=window.projectUrl+"/api/admin/players/"+this.customer.id;ironAjax.generateRequest()}},{key:"_customerDeleted",value:function _customerDeleted(){this.dispatchEvent(new CustomEvent("reload-players",{bubbles:!0,composed:!0}));this.dispatchEvent(new CustomEvent("show-modal",{bubbles:!0,composed:!0,detail:{title:"Deletion operation complete",message:"The user has been deleted with success"}}));this.set("route.path","/players/list/")}},{key:"_editCustomer",value:function _editCustomer(){var paperDialog=Polymer.dom(this.root).querySelector("paper-dialog#editCustomer"),form=Polymer.dom(this.root).querySelector("#formEditCustomer").serializeForm(),ironAjax=Polymer.dom(this.root).querySelector("#ajaxEditCustomer");if(!paperDialog.opened){paperDialog.toggle();return}if(0>=form.username.length)return this.dispatchEvent(new CustomEvent("show-modal",{bubbles:!0,composed:!0,detail:{title:"Error occured",message:"Please fill all the form correctly"}}));var payload={id:this.customer.id,username:form.username,permission:parseInt(form.permission),stats:this.customer.stats,mapId:parseInt(form.mapId),x:parseInt(form.x),y:parseInt(form.y)};payload.stats.gold=parseInt(form.gold);payload.stats.level=parseInt(form.level);ironAjax.method="PATCH";ironAjax.headers={"X-Access-Token":this.authSession.token,"X-Socket-ID":window.socket.id};ironAjax.url=window.projectUrl+"/api/admin/players/";ironAjax.body=payload;ironAjax.contentType="application/json";ironAjax.generateRequest()}},{key:"_customerEdited",value:function _customerEdited(){this.dispatchEvent(new CustomEvent("reload-players",{bubbles:!0,composed:!0}));this.dispatchEvent(new CustomEvent("show-modal",{bubbles:!0,composed:!0,detail:{title:"Operation successful",message:"The user has been edited with success"}}));this._reloadCustomer()}},{key:"_formatDate",value:function _formatDate(data){return moment(data).format("DD/MM/YY H:mm")}}],[{key:"is",get:function get(){return"players-view"}},{key:"properties",get:function get(){return{_actualId:{type:String,value:""},selectedTab:{type:Number,value:0},customer:{}}}},{key:"observers",get:function get(){return["_idChanged(routeData.id)"]}}]);return playersView}(Polymer.Element);window.customElements.define(playersView.is,playersView);</script></dom-module></body></html>